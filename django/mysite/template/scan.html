<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Measurement Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.12.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet@3.0.1"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">



  </head>
  <style>
  *{
    padding: 0;
    margin: 0;
      box-sizing: border-box;
  }
  body{
    background-image: url('https://htmlcolorcodes.com/assets/images/colors/light-pink-color-solid-background-1920x1080.png');
    background-size: cover;
    background-position: center;

    font-family: sans-serif;
  }
  .menu-ba{
    background: rgb(203,205,203);
    text-align: center;
  }
  .menu-ba ul{
    display: inline-flex;
    list-style: none;
    color: black;
  }
  .menu-ba ul li{
    width: 120px;
    margin: 15px;
    padding: 15px;
  }
  .menu-ba ul li a{
    text-decoration: none;
    color: black;
  }
  .active, .menu-ba ul li:hover{
    background: #BEACBB;
    border-radius: 3px;
  }
  .menu-ba .fa{
    margin-right: 8px;

  }
  .submenu-bar-1{
    display: none;
  }
  .menu-ba ul li:hover .submenu-bar-1{
    display: block;
    position: absolute;
    background: rgb(203,205,203);
    margin-top: 15px;
    margin-left: -15px;
  }
  .menu-ba ul li:hover .submenu-bar-1 ul{
    display: block;
    margin: 10px;
  }
  .menu-ba ul li:hover .submenu-bar-1 ul li{
    width: 150px;
    padding: 10px;
    border-bottom: 1px dotted black;
    background: transparent;
    border-radius: 0;
    text-align: left;
  }
    .menu-ba ul li:hover .submenu-bar-1 ul li:last-child
    {
      border-bottom: none;
    }
      .menu-ba ul li:hover .submenu-bar-1 ul li a:hover{
        color:  #BEACBB;
      }
      .menu{
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        justify-content: space-around;
      }
    .image-container{
      display: fex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;


    }
    .image-container img{
      margin-right: 10px;
      width: 200px;
      height: 200px;
      margin-bottom: 20px;
      margin-top: 20px;
    }
    .menu-ba ul img{
      position: absolute;
      top: 8px;
      left: 16px;

    }

    #layout{
      display:inline-flex;
      justify-content: space-around;
      flex-direction: row;
      flex-wrap: nowrap;
      list-style: none;
      text-align: center;
    }
    .layout-items{
      background-color: white;
      box-shadow: 8px 8px 8px rgba(0,0,0,0.8);
      border-radius: 5px;
      transition: 0.5s;
    }
    .layout-items:hover{
      transform: scale(1.15);
    }
    #pname{
      text-align: center;
      font-size:12px;
      margin-bottom: 0;
      font-weight: 500;
    }
    #price{
      text-align: center;
      font-size:12px;
      margin-bottom: 0;
      font-weight: 400;
    }
    .layout-items{
      margin-right: 10px;
      margin-bottom: 20px;
      margin-top: 20px;
    }
    img a{
      max-width: 20%;
    }
    .small{
      text-align: center;
    }
    .menu-ba ul img{
      position: absolute;
      top: 8px;
      left: 16px;

    }
    .footer {

   display: flex;
   align-items: center;
   flex-wrap: wrap;
   padding: 2rem 9%;
   color: var(--text-color);
   background: pink;
  }

  .footer-text p {
   font-size: 0.9rem;
  }
  .direct{
    text-align: center;
  }
  h3{
    color: #AA336A;
    margin-left: -750px;
  }

  .topnav input[type=text] {
  border: none;
  font-size: 17px;
  text-align: center;
  border-radius: 10px;
}

.topnav {
  overflow: hidden;
  align-items: center;
  text-align:center;
  margin-top: 10px;

}
mark {
  background-color: #AA336A;
  color: White;
  border-radius: 15px;
}


a.Capitalize{
  text-transform: capitalize;
}
.deco{
  text-decoration: none;

}
.buttonb{
  width: 120px;
  margin: 15px;
  padding: 15px;
   text-decoration: none;
}
.form-container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh; /* Adjust as needed */
}

.input-group {
    margin-top: 10px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
}

.input-group label {
    width: 120px; /* Adjust label width as needed */
}

.input-group input {
    flex: 1;
    padding: 8px; /* Adjust input padding as needed */
    border: 1px solid #ccc; /* Add desired border styles */
    border-radius: 5px; /* Add desired border radius */
    box-sizing: border-box;
}
 /* Add your CSS styles for the video and canvas elements */
 #video-container {
    position: relative;
    width: 100%;
    height: auto;
}
#video {
    width: 100%;
    height: auto;
}
#canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none; /* Hide canvas by default */
}
.scan-line {
    position: absolute;
    top: 0;
    left: 50%;
    width: 2px; /* Set width to desired thickness of the line */
    height: 100%;
    background-color: red; /* Red color */
    opacity: 0.5; /* Adjust opacity as needed */
    animation: scanAnimation 2s linear infinite;
}
@keyframes scanAnimation {
    0% {
        transform: translateY(0);
    }
    100% {
        transform: translateY(100%);
    }
}


  </style>

  <body>
    <div class="menu-ba">
      <ul>
        <img src="https://t4.ftcdn.net/jpg/04/13/53/87/360_F_413538737_E0dpfe6Bu4Wo4MgvoHTLLWrUhC1n4on8.jpg" width="60" height="50">

      </ul>
    <ul>
        <li><a href="/Category/"><i class="fa fa-home"></i>Home</a></li>
      <li><a href=""><i class="fa fa-bars"></i>Menu</a>
            <div class="submenu-bar-1">

               <ul>
                 <li><a href="http://127.0.0.1:8000/Woman/">Woman</a></li>
                 <li><a href="http://127.0.0.1:8000/Man/">Man</a></li>
                 <li><a href="http://127.0.0.1:8000/Children/">Child</a></li>
                 <!-- <li><a href="http://127.0.0.1:8000/Desired/">Desired</a></li> --> 
                 <li><a href="http://127.0.0.1:8000/Couples/">Couples</a></li>
               </ul>

            </div>
      </li>
      <li><a href="/cart/"><i class="fa fa-cart-plus"></i>Cart</a></li>
      <li  class="active"><a href="/size/"><i class="fa fa-upload"></i>Size</a></li>
      {% if request.user.is_authenticated %}
        <ul>
           <li><a href="/profile/" class ="Capitalize" >User:{{request.user}}</a>
               <div class="submenu-bar-1">
                 <ul>
                  <li><a href="/logout">Logout</a></li>
                 </ul>
               </div>
         </ul>
      {% endif %}
    </ul>
  </div>
   <!-- Form for real-time measurement scanner -->
   <div class="form-container">
    <form id="measurementForm" action="/size/" method="post">
        <!-- Include any messages if needed -->
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {% endfor %}
        <!-- CSRF token -->
        {% csrf_token %}

        <!-- Video container -->
        <div id="video-container">
            <!-- Video element for camera feed -->
            <video id="video" autoplay></video>

            <!-- Scan line -->
            <div class="scan-line"></div>
        </div>

        <!-- Canvas element for drawing -->
        <canvas id="canvas"></canvas>

        <!-- Submit button -->
        
    </form>
</div>
<script>
  async function setupCameraAndPoseDetection() {
      const video = document.getElementById('video');
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;

      const net = await posenet.load();
      detectPoseInRealTime(video, net);
  }

  async function detectPoseInRealTime(video, net) {
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      async function poseDetectionFrame() {
          const pose = await net.estimateSinglePose(video, {
              flipHorizontal: false
          });

          // Set canvas dimensions based on video dimensions
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;

          // Draw poses on the canvas
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

          // Draw lines for body measurements
          drawMeasurementLine(pose.keypoints, ctx, 'leftShoulder', 'rightShoulder', 'Shoulder');
          drawMeasurementLine(pose.keypoints, ctx, 'leftShoulder', 'leftHip', 'Waist');
          drawMeasurementLine(pose.keypoints, ctx, 'rightShoulder', 'rightHip', 'Waist');
          drawMeasurementLine(pose.keypoints, ctx, 'leftHip', 'leftKnee', 'Inseam');
          drawMeasurementLine(pose.keypoints, ctx, 'rightHip', 'rightKnee', 'Inseam');
          drawMeasurementLine(pose.keypoints, ctx, 'leftShoulder', 'leftAnkle', 'Floor');
          drawMeasurementLine(pose.keypoints, ctx, 'rightShoulder', 'rightAnkle', 'Floor');

          requestAnimationFrame(poseDetectionFrame);
      }
      poseDetectionFrame();

      // Delay saving and redirecting after 10 seconds
      setTimeout(async () => {
          const measurementsData = await saveMeasurements();
          if (measurementsData.success) {
              window.location.href = '/size/';
          } else {
              console.error('Error saving measurements:', measurementsData.message);
          }
      }, 10000); // 10 seconds
  }

  async function saveMeasurements() {
      // Perform the saving process here
      // Replace this with your actual saving logic
      return new Promise(resolve => {
          setTimeout(() => {
              resolve({ success: true });
          }, 2000); // Simulating a delay of 2 seconds for the saving process
      });
  }

  function drawMeasurementLine(keypoints, ctx, point1, point2, label) {
      const keypoint1 = keypoints.find(kp => kp.part === point1);
      const keypoint2 = keypoints.find(kp => kp.part === point2);
      if (keypoint1 && keypoint2) {
          ctx.beginPath();
          ctx.moveTo(keypoint1.position.x, keypoint1.position.y);
          ctx.lineTo(keypoint2.position.x, keypoint2.position.y);
          ctx.strokeStyle = 'red';
          ctx.stroke();
          // Add label near the middle of the line
          const labelX = (keypoint1.position.x + keypoint2.position.x) / 2;
          const labelY = (keypoint1.position.y + keypoint2.position.y) / 2;
          ctx.fillStyle = 'red';
          ctx.fillText(label, labelX, labelY);
      }
  }

  document.addEventListener('DOMContentLoaded', setupCameraAndPoseDetection);
</script>
<br><br>

  </body>
</html>
